{"version":3,"file":"load.js","sources":["../../../../../unplugin/dist/context-D49cMElb.js","../../../../../unplugin/dist/webpack-like-eCUNu7bZ.js","../../../../../unplugin/dist/context-eMLGDggc.js","../../../../../unplugin/dist/webpack/loaders/load.js"],"sourcesContent":["import { resolve } from \"node:path\";\nimport picomatch from \"picomatch\";\nimport { Parser } from \"acorn\";\n\n//#region src/utils/general.ts\nfunction toArray(array) {\n\tarray = array || [];\n\tif (Array.isArray(array)) return array;\n\treturn [array];\n}\n\n//#endregion\n//#region src/utils/filter.ts\nconst BACKSLASH_REGEX = /\\\\/g;\nfunction normalize$1(path$1) {\n\treturn path$1.replace(BACKSLASH_REGEX, \"/\");\n}\nconst ABSOLUTE_PATH_REGEX = /^(?:\\/|(?:[A-Z]:)?[/\\\\|])/i;\nfunction isAbsolute$1(path$1) {\n\treturn ABSOLUTE_PATH_REGEX.test(path$1);\n}\nfunction getMatcherString(glob, cwd) {\n\tif (glob.startsWith(\"**\") || isAbsolute$1(glob)) return normalize$1(glob);\n\tconst resolved = resolve(cwd, glob);\n\treturn normalize$1(resolved);\n}\nfunction patternToIdFilter(pattern) {\n\tif (pattern instanceof RegExp) return (id) => {\n\t\tconst normalizedId = normalize$1(id);\n\t\tconst result = pattern.test(normalizedId);\n\t\tpattern.lastIndex = 0;\n\t\treturn result;\n\t};\n\tconst cwd = process.cwd();\n\tconst glob = getMatcherString(pattern, cwd);\n\tconst matcher = picomatch(glob, { dot: true });\n\treturn (id) => {\n\t\tconst normalizedId = normalize$1(id);\n\t\treturn matcher(normalizedId);\n\t};\n}\nfunction patternToCodeFilter(pattern) {\n\tif (pattern instanceof RegExp) return (code) => {\n\t\tconst result = pattern.test(code);\n\t\tpattern.lastIndex = 0;\n\t\treturn result;\n\t};\n\treturn (code) => code.includes(pattern);\n}\nfunction createFilter(exclude, include) {\n\tif (!exclude && !include) return;\n\treturn (input) => {\n\t\tif (exclude?.some((filter) => filter(input))) return false;\n\t\tif (include?.some((filter) => filter(input))) return true;\n\t\treturn !(include && include.length > 0);\n\t};\n}\nfunction normalizeFilter(filter) {\n\tif (typeof filter === \"string\" || filter instanceof RegExp) return { include: [filter] };\n\tif (Array.isArray(filter)) return { include: filter };\n\treturn {\n\t\texclude: filter.exclude ? toArray(filter.exclude) : void 0,\n\t\tinclude: filter.include ? toArray(filter.include) : void 0\n\t};\n}\nfunction createIdFilter(filter) {\n\tif (!filter) return;\n\tconst { exclude, include } = normalizeFilter(filter);\n\tconst excludeFilter = exclude?.map(patternToIdFilter);\n\tconst includeFilter = include?.map(patternToIdFilter);\n\treturn createFilter(excludeFilter, includeFilter);\n}\nfunction createCodeFilter(filter) {\n\tif (!filter) return;\n\tconst { exclude, include } = normalizeFilter(filter);\n\tconst excludeFilter = exclude?.map(patternToCodeFilter);\n\tconst includeFilter = include?.map(patternToCodeFilter);\n\treturn createFilter(excludeFilter, includeFilter);\n}\nfunction createFilterForId(filter) {\n\tconst filterFunction = createIdFilter(filter);\n\treturn filterFunction ? (id) => !!filterFunction(id) : void 0;\n}\nfunction createFilterForTransform(idFilter, codeFilter) {\n\tif (!idFilter && !codeFilter) return;\n\tconst idFilterFunction = createIdFilter(idFilter);\n\tconst codeFilterFunction = createCodeFilter(codeFilter);\n\treturn (id, code) => {\n\t\tlet fallback = true;\n\t\tif (idFilterFunction) fallback &&= idFilterFunction(id);\n\t\tif (!fallback) return false;\n\t\tif (codeFilterFunction) fallback &&= codeFilterFunction(code);\n\t\treturn fallback;\n\t};\n}\nfunction normalizeObjectHook(name, hook) {\n\tlet handler;\n\tlet filter;\n\tif (typeof hook === \"function\") handler = hook;\n\telse {\n\t\thandler = hook.handler;\n\t\tconst hookFilter = hook.filter;\n\t\tif (name === \"resolveId\" || name === \"load\") filter = createFilterForId(hookFilter?.id);\n\t\telse filter = createFilterForTransform(hookFilter?.id, hookFilter?.code);\n\t}\n\treturn {\n\t\thandler,\n\t\tfilter: filter || (() => true)\n\t};\n}\n\n//#endregion\n//#region src/utils/context.ts\nfunction parse(code, opts = {}) {\n\treturn Parser.parse(code, {\n\t\tsourceType: \"module\",\n\t\tecmaVersion: \"latest\",\n\t\tlocations: true,\n\t\t...opts\n\t});\n}\n\n//#endregion\nexport { normalizeObjectHook, parse, toArray };","import { normalizeObjectHook } from \"./context-D49cMElb.js\";\nimport { isAbsolute, normalize } from \"node:path\";\n\n//#region src/utils/webpack-like.ts\nfunction transformUse(data, plugin, transformLoader) {\n\tif (data.resource == null) return [];\n\tconst id = normalizeAbsolutePath(data.resource + (data.resourceQuery || \"\"));\n\tif (plugin.transformInclude && !plugin.transformInclude(id)) return [];\n\tconst { filter } = normalizeObjectHook(\n\t\t// WARN: treat `transform` as `load` here, since cannot get `code` outside of `transform`\n\t\t// `code` should be checked in the loader\n\t\t\"load\",\n\t\tplugin.transform\n);\n\tif (!filter(id)) return [];\n\treturn [{\n\t\tloader: transformLoader,\n\t\toptions: { plugin },\n\t\tident: plugin.name\n\t}];\n}\nfunction normalizeAbsolutePath(path$1) {\n\tif (isAbsolute(path$1)) return normalize(path$1);\n\telse return path$1;\n}\n\n//#endregion\nexport { normalizeAbsolutePath, transformUse };","import { parse } from \"./context-D49cMElb.js\";\nimport { resolve } from \"node:path\";\nimport { Buffer } from \"node:buffer\";\nimport process from \"node:process\";\nimport { createRequire } from \"node:module\";\n\n//#region src/webpack/context.ts\nfunction contextOptionsFromCompilation(compilation) {\n\treturn {\n\t\taddWatchFile(file) {\n\t\t\t(compilation.fileDependencies ?? compilation.compilationDependencies).add(file);\n\t\t},\n\t\tgetWatchFiles() {\n\t\t\treturn Array.from(compilation.fileDependencies ?? compilation.compilationDependencies);\n\t\t}\n\t};\n}\nconst require = createRequire(import.meta.url);\nfunction getSource(fileSource) {\n\tconst webpack = require(\"webpack\");\n\treturn new webpack.sources.RawSource(typeof fileSource === \"string\" ? fileSource : Buffer.from(fileSource.buffer));\n}\nfunction createBuildContext(options, compiler, compilation, loaderContext) {\n\treturn {\n\t\tparse,\n\t\taddWatchFile(id) {\n\t\t\toptions.addWatchFile(resolve(process.cwd(), id));\n\t\t},\n\t\temitFile(emittedFile) {\n\t\t\tconst outFileName = emittedFile.fileName || emittedFile.name;\n\t\t\tif (emittedFile.source && outFileName) {\n\t\t\t\tif (!compilation) throw new Error(\"unplugin/webpack: emitFile outside supported hooks  (buildStart, buildEnd, load, transform, watchChange)\");\n\t\t\t\tcompilation.emitAsset(outFileName, getSource(emittedFile.source));\n\t\t\t}\n\t\t},\n\t\tgetWatchFiles() {\n\t\t\treturn options.getWatchFiles();\n\t\t},\n\t\tgetNativeBuildContext() {\n\t\t\treturn {\n\t\t\t\tframework: \"webpack\",\n\t\t\t\tcompiler,\n\t\t\t\tcompilation,\n\t\t\t\tloaderContext\n\t\t\t};\n\t\t}\n\t};\n}\nfunction createContext(loader) {\n\treturn {\n\t\terror: (error) => loader.emitError(normalizeMessage(error)),\n\t\twarn: (message) => loader.emitWarning(normalizeMessage(message))\n\t};\n}\nfunction normalizeMessage(error) {\n\tconst err = new Error(typeof error === \"string\" ? error : error.message);\n\tif (typeof error === \"object\") {\n\t\terr.stack = error.stack;\n\t\terr.cause = error.meta;\n\t}\n\treturn err;\n}\n\n//#endregion\nexport { contextOptionsFromCompilation, createBuildContext as createBuildContext$1, createContext as createContext$1, normalizeMessage as normalizeMessage$1 };","import { normalizeObjectHook } from \"../../context-D49cMElb.js\";\nimport { normalizeAbsolutePath } from \"../../webpack-like-eCUNu7bZ.js\";\nimport { createBuildContext$1 as createBuildContext, createContext$1 as createContext } from \"../../context-eMLGDggc.js\";\n\n//#region src/webpack/loaders/load.ts\nasync function load(source, map) {\n\tconst callback = this.async();\n\tconst { plugin } = this.query;\n\tlet id = this.resource;\n\tif (!plugin?.load || !id) return callback(null, source, map);\n\tif (id.startsWith(plugin.__virtualModulePrefix)) id = decodeURIComponent(id.slice(plugin.__virtualModulePrefix.length));\n\tconst context = createContext(this);\n\tconst { handler } = normalizeObjectHook(\"load\", plugin.load);\n\tconst res = await handler.call(Object.assign({}, createBuildContext({\n\t\taddWatchFile: (file) => {\n\t\t\tthis.addDependency(file);\n\t\t},\n\t\tgetWatchFiles: () => {\n\t\t\treturn this.getDependencies();\n\t\t}\n\t}, this._compiler, this._compilation, this), context), normalizeAbsolutePath(id));\n\tif (res == null) callback(null, source, map);\n\telse if (typeof res !== \"string\") callback(null, res.code, res.map ?? map);\n\telse callback(null, res, map);\n}\n\n//#endregion\nexport { load as default };"],"names":["resolve","Parser","isAbsolute","normalize","require","createRequire","Buffer","process"],"mappings":"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"}