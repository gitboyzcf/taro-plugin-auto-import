{"version":3,"file":"transform.js","sources":["../../../../../unplugin/dist/context-D49cMElb.js","../../../../../unplugin/dist/context-D_KPTgTH.js","../../../../../unplugin/dist/rspack/loaders/transform.js"],"sourcesContent":["import { resolve } from \"node:path\";\nimport picomatch from \"picomatch\";\nimport { Parser } from \"acorn\";\n\n//#region src/utils/general.ts\nfunction toArray(array) {\n\tarray = array || [];\n\tif (Array.isArray(array)) return array;\n\treturn [array];\n}\n\n//#endregion\n//#region src/utils/filter.ts\nconst BACKSLASH_REGEX = /\\\\/g;\nfunction normalize$1(path$1) {\n\treturn path$1.replace(BACKSLASH_REGEX, \"/\");\n}\nconst ABSOLUTE_PATH_REGEX = /^(?:\\/|(?:[A-Z]:)?[/\\\\|])/i;\nfunction isAbsolute$1(path$1) {\n\treturn ABSOLUTE_PATH_REGEX.test(path$1);\n}\nfunction getMatcherString(glob, cwd) {\n\tif (glob.startsWith(\"**\") || isAbsolute$1(glob)) return normalize$1(glob);\n\tconst resolved = resolve(cwd, glob);\n\treturn normalize$1(resolved);\n}\nfunction patternToIdFilter(pattern) {\n\tif (pattern instanceof RegExp) return (id) => {\n\t\tconst normalizedId = normalize$1(id);\n\t\tconst result = pattern.test(normalizedId);\n\t\tpattern.lastIndex = 0;\n\t\treturn result;\n\t};\n\tconst cwd = process.cwd();\n\tconst glob = getMatcherString(pattern, cwd);\n\tconst matcher = picomatch(glob, { dot: true });\n\treturn (id) => {\n\t\tconst normalizedId = normalize$1(id);\n\t\treturn matcher(normalizedId);\n\t};\n}\nfunction patternToCodeFilter(pattern) {\n\tif (pattern instanceof RegExp) return (code) => {\n\t\tconst result = pattern.test(code);\n\t\tpattern.lastIndex = 0;\n\t\treturn result;\n\t};\n\treturn (code) => code.includes(pattern);\n}\nfunction createFilter(exclude, include) {\n\tif (!exclude && !include) return;\n\treturn (input) => {\n\t\tif (exclude?.some((filter) => filter(input))) return false;\n\t\tif (include?.some((filter) => filter(input))) return true;\n\t\treturn !(include && include.length > 0);\n\t};\n}\nfunction normalizeFilter(filter) {\n\tif (typeof filter === \"string\" || filter instanceof RegExp) return { include: [filter] };\n\tif (Array.isArray(filter)) return { include: filter };\n\treturn {\n\t\texclude: filter.exclude ? toArray(filter.exclude) : void 0,\n\t\tinclude: filter.include ? toArray(filter.include) : void 0\n\t};\n}\nfunction createIdFilter(filter) {\n\tif (!filter) return;\n\tconst { exclude, include } = normalizeFilter(filter);\n\tconst excludeFilter = exclude?.map(patternToIdFilter);\n\tconst includeFilter = include?.map(patternToIdFilter);\n\treturn createFilter(excludeFilter, includeFilter);\n}\nfunction createCodeFilter(filter) {\n\tif (!filter) return;\n\tconst { exclude, include } = normalizeFilter(filter);\n\tconst excludeFilter = exclude?.map(patternToCodeFilter);\n\tconst includeFilter = include?.map(patternToCodeFilter);\n\treturn createFilter(excludeFilter, includeFilter);\n}\nfunction createFilterForId(filter) {\n\tconst filterFunction = createIdFilter(filter);\n\treturn filterFunction ? (id) => !!filterFunction(id) : void 0;\n}\nfunction createFilterForTransform(idFilter, codeFilter) {\n\tif (!idFilter && !codeFilter) return;\n\tconst idFilterFunction = createIdFilter(idFilter);\n\tconst codeFilterFunction = createCodeFilter(codeFilter);\n\treturn (id, code) => {\n\t\tlet fallback = true;\n\t\tif (idFilterFunction) fallback &&= idFilterFunction(id);\n\t\tif (!fallback) return false;\n\t\tif (codeFilterFunction) fallback &&= codeFilterFunction(code);\n\t\treturn fallback;\n\t};\n}\nfunction normalizeObjectHook(name, hook) {\n\tlet handler;\n\tlet filter;\n\tif (typeof hook === \"function\") handler = hook;\n\telse {\n\t\thandler = hook.handler;\n\t\tconst hookFilter = hook.filter;\n\t\tif (name === \"resolveId\" || name === \"load\") filter = createFilterForId(hookFilter?.id);\n\t\telse filter = createFilterForTransform(hookFilter?.id, hookFilter?.code);\n\t}\n\treturn {\n\t\thandler,\n\t\tfilter: filter || (() => true)\n\t};\n}\n\n//#endregion\n//#region src/utils/context.ts\nfunction parse(code, opts = {}) {\n\treturn Parser.parse(code, {\n\t\tsourceType: \"module\",\n\t\tecmaVersion: \"latest\",\n\t\tlocations: true,\n\t\t...opts\n\t});\n}\n\n//#endregion\nexport { normalizeObjectHook, parse, toArray };","import { parse } from \"./context-D49cMElb.js\";\nimport { resolve } from \"node:path\";\nimport { Buffer } from \"node:buffer\";\n\n//#region src/rspack/context.ts\nfunction createBuildContext(compiler, compilation, loaderContext) {\n\treturn {\n\t\tgetNativeBuildContext() {\n\t\t\treturn {\n\t\t\t\tframework: \"rspack\",\n\t\t\t\tcompiler,\n\t\t\t\tcompilation,\n\t\t\t\tloaderContext\n\t\t\t};\n\t\t},\n\t\taddWatchFile(file) {\n\t\t\tconst cwd = process.cwd();\n\t\t\tcompilation.fileDependencies.add(resolve(cwd, file));\n\t\t},\n\t\tgetWatchFiles() {\n\t\t\treturn Array.from(compilation.fileDependencies);\n\t\t},\n\t\tparse,\n\t\temitFile(emittedFile) {\n\t\t\tconst outFileName = emittedFile.fileName || emittedFile.name;\n\t\t\tif (emittedFile.source && outFileName) {\n\t\t\t\tconst { sources } = compilation.compiler.webpack;\n\t\t\t\tcompilation.emitAsset(outFileName, new sources.RawSource(typeof emittedFile.source === \"string\" ? emittedFile.source : Buffer.from(emittedFile.source)));\n\t\t\t}\n\t\t}\n\t};\n}\nfunction createContext(loader) {\n\treturn {\n\t\terror: (error) => loader.emitError(normalizeMessage(error)),\n\t\twarn: (message) => loader.emitWarning(normalizeMessage(message))\n\t};\n}\nfunction normalizeMessage(error) {\n\tconst err = new Error(typeof error === \"string\" ? error : error.message);\n\tif (typeof error === \"object\") {\n\t\terr.stack = error.stack;\n\t\terr.cause = error.meta;\n\t}\n\treturn err;\n}\n\n//#endregion\nexport { createBuildContext, createContext, normalizeMessage };","import { normalizeObjectHook } from \"../../context-D49cMElb.js\";\nimport { createBuildContext, createContext } from \"../../context-D_KPTgTH.js\";\n\n//#region src/rspack/loaders/transform.ts\nasync function transform(source, map) {\n\tconst callback = this.async();\n\tconst { plugin } = this.query;\n\tif (!plugin?.transform) return callback(null, source, map);\n\tconst id = this.resource;\n\tconst context = createContext(this);\n\tconst { handler, filter } = normalizeObjectHook(\"transform\", plugin.transform);\n\tif (!filter(this.resource, source)) return callback(null, source, map);\n\ttry {\n\t\tconst res = await handler.call(Object.assign({}, this._compilation && createBuildContext(this._compiler, this._compilation, this), context), source, id);\n\t\tif (res == null) callback(null, source, map);\n\t\telse if (typeof res !== \"string\") callback(null, res.code, map == null ? map : res.map || map);\n\t\telse callback(null, res, map);\n\t} catch (error) {\n\t\tif (error instanceof Error) callback(error);\n\t\telse callback(new Error(String(error)));\n\t}\n}\n\n//#endregion\nexport { transform as default };"],"names":["resolve","Parser","Buffer"],"mappings":"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"}